# API のデザインパターンについて

基本的に、REST 前提です。

## 命名について

以下の規則を守る。

- 小文字を使う
  - 標準仕様で定められている
- /で区切る
  - ただし末尾にはつけない
- ケバブケース
  - 一応ハイフンで区切ると、単語として認識される（SEO 対策）
    - 今はほとんど影響しないらしい
  - 読みやすい

## ステートフル、ステートレスについて

イメージ的には、処理が独立しているのがステートレスで処理に流れが存在するのがステートフル。

## GET メソッドについて

冪等性を持つ必要がある。簡単にいうと、常に同じリクエストに対しては同じ結果を返す性質。

## カスタムメソッド

エンドポイントに対し、`:${METHOD_NAME}`の形で拡張する。

例: `/test:run-test`

標準メソッドと違い、自由度の高い処理を実装できる一方で、標準メソッドで済む内容は標準メソッドで実装した方が良い。また、メソッドは基本的に POST を採用する。一部の場合（冪等性を持つ場合）のみ、GET メソッドを使用しても良い。

## シングルトンサブリソースという考え方

モデルのうち、一部のリソースをシングルトンの形式で分離する。これは、セキュリティやボラリティ上のメリットが存在する。

例: ライドシェアサービスのドライバーのモデルの位置情報のみを分離する（頻繁に更新するので、ボラリティ）、従業員情報を保持するサービスの報酬情報のみ分離する（セキュリティ）

ただし、アトミック性がトレードオフになってしまう。

## バッチ処理

複数のリソースに対してまとめて操作を行う処理。`batch-${METHOD}`と命名するのが良い？親リソースではなくコレクションに対して定義するべき。

## 分割取得

リソース数が多くなった場合に、分割して取得する。以下に注意

- 設計によるが、最大何項目と設定するべき
  - 500 億レコードの中から該当するものを検索して 10 項目ずつ返す場合に、10 項目きっかり探すために莫大な時間を費やす可能性があるから
  - 最小、最大と時間制限等により制御すると良い
- 総数表示は簡単にはサポートしない
  - 約 500 億レコード存在する時、カウントするだけで莫大な時間がかかる（DB の仕様による気もするが）
  - よく考える
- 終了のタイミング
  - 基本的にレスポンスに次のページを取得するためのトークンを持たせ、それが含まれなくなったら終了とするべき
  - 取得結果が空になったらと判定すると、良くない

## 出典

- API デザインパターン(マイナビ出版)
